{% extends "base.html" %}
{% load static %}

{% block title %}AfriTube - Home{% endblock %}

{% block content %}
<div class="youtube-container">
    <!-- Main Content Area -->
    <div class="content-wrapper">
        <!-- Live Streams Section -->
        {% if live_streams %}
        <section class="content-section">
            <div class="section-header">
                <h2 class="section-title">
                    <svg class="live-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M14,12L14,12c0,1.1-0.9,2-2,2s-2-0.9-2-2s0.9-2,2-2S14,10.9,14,12z M8.48,8.45L7.77,7.75 C6.68,8.83,6,10.34,6,12s0.68,3.17,1.77,4.25l0.71-0.71C7.57,14.64,7,13.39,7,12S7.57,9.36,8.48,8.45z M16.23,7.75l-0.71,0.71 C16.43,9.36,17,10.61,17,12s-0.57,2.64-1.48,3.55l0.71,0.71C17.32,15.17,18,13.66,18,12S17.32,8.83,16.23,7.75z M5.65,5.63 L4.95,4.93C3.13,6.73,2,9.24,2,12s1.13,5.27,2.95,7.07l0.71-0.71C4.02,16.74,3,14.49,3,12S4.02,7.26,5.65,5.63z M19.05,4.93 l-0.71,0.71C19.98,7.26,21,9.51,21,12s-1.02,4.74-2.65,6.37l0.71,0.71C20.87,17.27,22,14.76,22,12S20.87,6.73,19.05,4.93z"/>
                    </svg>
                    Live
                </h2>
            </div>
            <div class="video-grid live-grid">
                {% for stream in live_streams %}
                <div class="video-item">
                    <a href="{% url 'stream_detail' stream.stream_id %}" class="video-link">
                        <div class="thumbnail-wrapper">
                            <img src="{{ stream.thumbnail.url }}" alt="{{ stream.title }}" class="thumbnail">
                            <div class="live-badge">
                                <span class="live-dot"></span>
                                LIVE
                            </div>
                            <span class="viewer-badge">
                                {{ stream.current_viewers|default:"0" }} watching
                            </span>
                        </div>
                        <div class="video-metadata">
                            <img src="{{ stream.creator.get_profile_picture_url }}" alt="{{ stream.creator.username }}" class="channel-avatar">
                            <div class="video-info">
                                <h3 class="video-title">{{ stream.title }}</h3>
                                <p class="channel-name">{{ stream.creator.channel_name|default:stream.creator.username }}</p>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Shorts Section -->
        {% if shorts %}
        <section class="content-section">
            <div class="section-header">
                <h2 class="section-title">
                    <svg class="shorts-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 14.65v-5.3L15 12l-5 2.65zm7.77-4.33c-.77-.32-1.2-.5-1.2-.5L18 9.06c1.84-.96 2.53-3.23 1.56-5.06s-3.24-2.53-5.07-1.56L6 6.94c-1.29.68-2.07 2.04-2 3.49.07 1.42.93 2.67 2.22 3.25.03.01 1.2.5 1.2.5L6 14.93c-1.83.97-2.53 3.24-1.56 5.07.97 1.83 3.24 2.53 5.07 1.56l8.5-4.5c1.29-.68 2.06-2.04 1.99-3.49-.07-1.42-.94-2.68-2.23-3.25zm-.23 5.86l-8.5 4.5c-1.34.71-3.01.2-3.72-1.14-.71-1.34-.2-3.01 1.14-3.72l2.04-1.08v-1.21l-.69-.28-1.11-.46c-.99-.41-1.65-1.35-1.7-2.41-.05-1.06.52-2.06 1.46-2.56l8.5-4.5c1.34-.71 3.01-.2 3.72 1.14.71 1.34.2 3.01-1.14 3.72L15.5 9.26v1.21l1.8.74c.99.41 1.65 1.35 1.7 2.41.05 1.06-.52 2.06-1.46 2.56z"/>
                    </svg>
                    Shorts
                </h2>
            </div>
            <div class="shorts-grid">
                {% for short in shorts %}
                <div class="short-item">
                    <a href="{% url 'video_detail' short.video_id %}" class="short-link">
                        <div class="short-thumbnail">
                            <img src="{{ short.thumbnail.url }}" alt="{{ short.title }}" class="short-img">
                            <div class="short-views-badge">{{ short.view_count|default:"0" }} views</div>
                        </div>
                        <p class="short-title">{{ short.title|truncatechars:40 }}</p>
                    </a>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Main Videos Section -->
        <section class="content-section">
            {% if recommended_videos or videos %}
            <div class="video-grid">
                {% for recommendation in recommended_videos %}
                {% with video=recommendation.video %}
                <div class="video-item">
                    <a href="{% url 'video_detail' video.video_id %}" class="video-link">
                        <div class="thumbnail-wrapper">
                            <img src="{{ video.thumbnail.url }}" alt="{{ video.title }}" class="thumbnail">
                            <span class="duration">{{ video.duration|date:"i:s" }}</span>
                            {% if video.video_type == 'premium' %}
                            <span class="badge-premium">Premium</span>
                            {% elif video.video_type == 'pay_per_view' %}
                            <span class="badge-ppv">${{ video.price }}</span>
                            {% endif %}
                        </div>
                        <div class="video-metadata">
                            <img src="{{ video.creator.get_profile_picture_url }}" alt="{{ video.creator.username }}" class="channel-avatar">
                            <div class="video-info">
                                <h3 class="video-title">{{ video.title }}</h3>
                                <p class="channel-name">
                                    {{ video.creator.channel_name|default:video.creator.username }}
                                    {% if video.creator.is_verified %}
                                    <svg class="verified-icon" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10S17.5,2,12,2z M9.8,17.3l-4.2-4.1L7,11.8l2.8,2.7L17,7.4l1.4,1.4 L9.8,17.3z"/>
                                    </svg>
                                    {% endif %}
                                </p>
                                <p class="video-stats">
                                    {{ video.view_count|default:"0" }} views • {{ video.published_at|timesince }} ago
                                </p>
                            </div>
                        </div>
                    </a>
                </div>
                {% endwith %}
                {% endfor %}

                {% for video in videos %}
                <div class="video-item">
                    <a href="{% url 'video_detail' video.video_id %}" class="video-link">
                        <div class="thumbnail-wrapper">
                            <img src="{{ video.thumbnail.url }}" alt="{{ video.title }}" class="thumbnail">
                            <span class="duration">{{ video.duration|date:"i:s" }}</span>
                            {% if video.video_type == 'premium' %}
                            <span class="badge-premium">Premium</span>
                            {% elif video.video_type == 'pay_per_view' %}
                            <span class="badge-ppv">${{ video.price }}</span>
                            {% endif %}
                        </div>
                        <div class="video-metadata">
                            <img src="{{ video.creator.get_profile_picture_url }}" alt="{{ video.creator.username }}" class="channel-avatar">
                            <div class="video-info">
                                <h3 class="video-title">{{ video.title }}</h3>
                                <p class="channel-name">
                                    {{ video.creator.channel_name|default:video.creator.username }}
                                    {% if video.creator.is_verified %}
                                    <svg class="verified-icon" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10S17.5,2,12,2z M9.8,17.3l-4.2-4.1L7,11.8l2.8,2.7L17,7.4l1.4,1.4 L9.8,17.3z"/>
                                    </svg>
                                    {% endif %}
                                </p>
                                <p class="video-stats">
                                    {{ video.view_count|default:"0" }} views • {{ video.published_at|timesince }} ago
                                </p>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <svg class="empty-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
                </svg>
                <h3>No videos available</h3>
                <p>Check back later for new content</p>
            </div>
            {% endif %}
        </section>

        <!-- Pagination -->
        {% if videos.has_other_pages %}
        <nav class="pagination-nav">
            {% if videos.has_previous %}
            <a href="?page={{ videos.previous_page_number }}" class="pagination-btn">Previous</a>
            {% endif %}
            
            {% for num in videos.paginator.page_range %}
                {% if videos.number == num %}
                <span class="page-number active">{{ num }}</span>
                {% elif num > videos.number|add:'-3' and num < videos.number|add:'3' %}
                <a href="?page={{ num }}" class="page-number">{{ num }}</a>
                {% endif %}
            {% endfor %}

            {% if videos.has_next %}
            <a href="?page={{ videos.next_page_number }}" class="pagination-btn">Next</a>
            {% endif %}
        </nav>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Modern YouTube-like Layout */
    .youtube-container {
        background: #f9f9f9;
        min-height: 100vh;
        padding-top: 56px;
    }

    .content-wrapper {
        max-width: 1920px;
        margin: 0 auto;
        padding: 24px 24px 48px;
    }

    /* Section Styles */
    .content-section {
        margin-bottom: 48px;
    }

    .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 16px;
        padding: 0 0 12px 0;
    }

    .section-title {
        font-size: 20px;
        font-weight: 600;
        color: #030303;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .live-icon,
    .shorts-icon {
        width: 24px;
        height: 24px;
        color: #ff0000;
    }

    /* Video Grid */
    .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 24px 16px;
    }

    .live-grid {
        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
    }

    .video-item {
        background: transparent;
    }

    .video-link {
        text-decoration: none;
        color: inherit;
        display: block;
    }

    .thumbnail-wrapper {
        position: relative;
        width: 100%;
        aspect-ratio: 16/9;
        border-radius: 12px;
        overflow: hidden;
        background: #e5e5e5;
        margin-bottom: 12px;
        transition: transform 0.2s;
    }

    .video-item:hover .thumbnail-wrapper {
        transform: scale(1.02);
    }

    .thumbnail {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .duration {
        position: absolute;
        bottom: 6px;
        right: 6px;
        background: rgba(0, 0, 0, 0.85);
        color: white;
        padding: 3px 6px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
        font-family: 'Roboto', sans-serif;
    }

    .live-badge {
        position: absolute;
        top: 8px;
        left: 8px;
        background: #cc0000;
        color: white;
        padding: 2px 8px;
        border-radius: 3px;
        font-size: 12px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .live-dot {
        width: 6px;
        height: 6px;
        background: white;
        border-radius: 50%;
        animation: pulse 2s ease-in-out infinite;
    }

    .viewer-badge {
        position: absolute;
        bottom: 6px;
        left: 6px;
        background: rgba(0, 0, 0, 0.85);
        color: white;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
    }

    .badge-premium {
        position: absolute;
        top: 8px;
        left: 8px;
        background: #ffd700;
        color: #000;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
    }

    .badge-ppv {
        position: absolute;
        top: 8px;
        left: 8px;
        background: #065fd4;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
    }

    .video-metadata {
        display: flex;
        gap: 12px;
    }

    .channel-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        flex-shrink: 0;
        object-fit: cover;
    }

    .video-info {
        flex: 1;
        min-width: 0;
    }

    .video-title {
        font-size: 14px;
        font-weight: 500;
        color: #030303;
        line-height: 1.4;
        margin: 0 0 4px 0;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .channel-name {
        font-size: 12px;
        color: #606060;
        margin: 0 0 2px 0;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .verified-icon {
        width: 14px;
        height: 14px;
        color: #606060;
    }

    .video-stats {
        font-size: 12px;
        color: #606060;
        margin: 0;
    }

    /* Shorts Grid */
    .shorts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 16px;
    }

    .short-item {
        background: transparent;
    }

    .short-link {
        text-decoration: none;
        color: inherit;
        display: block;
    }

    .short-thumbnail {
        position: relative;
        width: 100%;
        aspect-ratio: 9/16;
        border-radius: 12px;
        overflow: hidden;
        background: #e5e5e5;
        margin-bottom: 8px;
        transition: transform 0.2s;
    }

    .short-item:hover .short-thumbnail {
        transform: scale(1.02);
    }

    .short-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .short-views-badge {
        position: absolute;
        bottom: 8px;
        left: 8px;
        color: white;
        font-size: 12px;
        font-weight: 500;
        text-shadow: 0 1px 3px rgba(0,0,0,0.6);
    }

    .short-title {
        font-size: 14px;
        font-weight: 500;
        color: #030303;
        margin: 0;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 20px;
    }

    .empty-icon {
        width: 120px;
        height: 120px;
        color: #909090;
        margin: 0 auto 24px;
    }

    .empty-state h3 {
        font-size: 20px;
        font-weight: 400;
        color: #030303;
        margin: 0 0 8px 0;
    }

    .empty-state p {
        font-size: 14px;
        color: #606060;
        margin: 0;
    }

    /* Pagination */
    .pagination-nav {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        margin-top: 32px;
    }

    .pagination-btn,
    .page-number {
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
        text-decoration: none;
        transition: background-color 0.2s;
    }

    .pagination-btn {
        background: transparent;
        color: #065fd4;
        border: 1px solid #e5e5e5;
    }

    .pagination-btn:hover {
        background: #f2f2f2;
    }

    .page-number {
        background: transparent;
        color: #606060;
        min-width: 40px;
        text-align: center;
    }

    .page-number.active {
        background: #065fd4;
        color: white;
    }

    .page-number:not(.active):hover {
        background: #f2f2f2;
        color: #030303;
    }

    /* Animation */
    @keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.4;
        }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .video-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }
        
        .live-grid {
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        }
    }

    @media (max-width: 900px) {
        .content-wrapper {
            padding: 16px 16px 32px;
        }

        .video-grid {
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 16px 12px;
        }

        .live-grid {
            grid-template-columns: 1fr;
        }

        .shorts-grid {
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        }
    }

    @media (max-width: 600px) {
        .content-wrapper {
            padding: 12px 12px 24px;
        }

        .video-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .shorts-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .section-title {
            font-size: 18px;
        }

        .video-title {
            font-size: 13px;
        }

        .channel-avatar {
            width: 32px;
            height: 32px;
        }
    }
</style>
{% endblock %}