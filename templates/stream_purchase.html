{% extends "base.html" %}
{% load static %}

{% block title %}Purchase Access - {{ stream.title }} - AfriTube{% endblock %}

{% block content %}
<div class="purchase-page">
    <div class="purchase-container">
        <!-- Header -->
        <div class="purchase-header">
            <h1 class="header-title">Complete your purchase</h1>
            <p class="header-subtitle">Get instant access to this premium stream</p>
        </div>

        <div class="purchase-layout">
            <!-- Order Summary -->
            <div class="order-summary">
                <h2 class="section-title">Order summary</h2>
                
                <div class="stream-card">
                    <div class="stream-thumbnail">
                        <img src="{{ stream.thumbnail.url }}" alt="{{ stream.title }}">
                        <span class="premium-badge">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            Premium
                        </span>
                    </div>
                    
                    <div class="stream-info">
                        <h3 class="stream-title">{{ stream.title }}</h3>
                        <p class="stream-creator">
                            {{ stream.creator.channel_name|default:stream.creator.username }}
                            {% if stream.creator.is_verified %}
                            <svg class="verified-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10S17.5,2,12,2z M9.8,17.3l-4.2-4.1L7,11.8l2.8,2.7L17,7.4l1.4,1.4 L9.8,17.3z"/>
                            </svg>
                            {% endif %}
                        </p>
                    </div>
                </div>

                <div class="stream-details">
                    <div class="detail-row">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                        </svg>
                        <div class="detail-content">
                            <span class="detail-label">Start time</span>
                            <span class="detail-value">{{ stream.scheduled_start|date:"F j, Y" }} at {{ stream.scheduled_start|time:"g:i A" }}</span>
                        </div>
                    </div>

                    {% if stream.category %}
                    <div class="detail-row">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"/>
                        </svg>
                        <div class="detail-content">
                            <span class="detail-label">Category</span>
                            <span class="detail-value">{{ stream.category.name }}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <div class="features-section">
                    <h4 class="features-title">What's included</h4>
                    <ul class="features-list">
                        <li>
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                            Full access to live stream
                        </li>
                        <li>
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                            Participate in live chat
                        </li>
                        <li>
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                            Watch recording after stream
                        </li>
                        <li>
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                            Download option (if available)
                        </li>
                    </ul>
                </div>

                <div class="price-breakdown">
                    <div class="price-row">
                        <span>Stream access</span>
                        <span>${{ stream.ticket_price }}</span>
                    </div>
                    <div class="price-row total">
                        <span>Total</span>
                        <span class="total-amount">${{ stream.ticket_price }}</span>
                    </div>
                </div>
            </div>

            <!-- Payment Form -->
            <div class="payment-section">
                <h2 class="section-title">Payment method</h2>

                <form method="post" class="payment-form">
                    {% csrf_token %}
                    
                    <div class="payment-methods">
                        <label class="payment-method">
                            <input type="radio" name="payment_method" value="card" checked>
                            <div class="method-content">
                                <div class="method-header">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/>
                                    </svg>
                                    <span class="method-name">Credit or debit card</span>
                                </div>
                                <div class="method-logos">
                                    <span class="card-logo visa">VISA</span>
                                    <span class="card-logo mastercard">MC</span>
                                    <span class="card-logo amex">AMEX</span>
                                </div>
                            </div>
                        </label>

                        <label class="payment-method">
                            <input type="radio" name="payment_method" value="paypal">
                            <div class="method-content">
                                <div class="method-header">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M9.93 12.99c-.1 0-.18-.02-.27-.06-.09-.04-.16-.09-.22-.17s-.1-.16-.12-.26c-.02-.1-.02-.2 0-.3l.84-4.67c.06-.31.3-.53.61-.53h2.8c.63 0 1.14.21 1.52.62.38.41.57.94.57 1.59 0 .93-.28 1.66-.84 2.19-.56.53-1.3.79-2.22.79h-2.67zm7.9-5.67c-.56-.61-1.38-.92-2.47-.92h-3.69c-.63 0-1.18.44-1.31 1.05l-1.56 8.76c-.09.5.28.96.79.96h2.18c.63 0 1.18-.44 1.31-1.05l.38-2.14h1.92c1.43 0 2.61-.43 3.53-1.29.92-.86 1.38-2.03 1.38-3.51 0-1.14-.38-2.07-1.15-2.78l-.31-.08z"/>
                                    </svg>
                                    <span class="method-name">PayPal</span>
                                </div>
                            </div>
                        </label>

                        <label class="payment-method">
                            <input type="radio" name="payment_method" value="mpesa">
                            <div class="method-content">
                                <div class="method-header">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"/>
                                    </svg>
                                    <span class="method-name">M-Pesa</span>
                                </div>
                                <span class="method-description">Mobile money</span>
                            </div>
                        </label>
                    </div>

                    <!-- Card Payment Fields -->
                    <div class="payment-fields card-fields">
                        <div class="form-group">
                            <label class="form-label">Card number</label>
                            <input type="text" 
                                   id="card_number"
                                   name="card_number"
                                   class="form-input" 
                                   placeholder="1234 5678 9012 3456"
                                   maxlength="19">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Expiry date</label>
                                <input type="text" 
                                       id="expiry_date"
                                       name="expiry_date"
                                       class="form-input" 
                                       placeholder="MM/YY"
                                       maxlength="5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">CVV</label>
                                <input type="text" 
                                       id="cvv"
                                       name="cvv"
                                       class="form-input" 
                                       placeholder="123"
                                       maxlength="4">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Cardholder name</label>
                            <input type="text" 
                                   id="card_holder"
                                   name="card_holder"
                                   class="form-input" 
                                   placeholder="Name on card">
                        </div>
                    </div>

                    <!-- PayPal Fields -->
                    <div class="payment-fields paypal-fields d-none">
                        <div class="paypal-redirect">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9.93 12.99c-.1 0-.18-.02-.27-.06-.09-.04-.16-.09-.22-.17s-.1-.16-.12-.26c-.02-.1-.02-.2 0-.3l.84-4.67c.06-.31.3-.53.61-.53h2.8c.63 0 1.14.21 1.52.62.38.41.57.94.57 1.59 0 .93-.28 1.66-.84 2.19-.56.53-1.3.79-2.22.79h-2.67zm7.9-5.67c-.56-.61-1.38-.92-2.47-.92h-3.69c-.63 0-1.18.44-1.31 1.05l-1.56 8.76c-.09.5.28.96.79.96h2.18c.63 0 1.18-.44 1.31-1.05l.38-2.14h1.92c1.43 0 2.61-.43 3.53-1.29.92-.86 1.38-2.03 1.38-3.51 0-1.14-.38-2.07-1.15-2.78l-.31-.08z"/>
                            </svg>
                            <p>You'll be redirected to PayPal to securely complete your payment</p>
                        </div>
                    </div>

                    <!-- M-Pesa Fields -->
                    <div class="payment-fields mpesa-fields d-none">
                        <div class="form-group">
                            <label class="form-label">Phone number</label>
                            <input type="tel" 
                                   id="mpesa_number"
                                   name="mpesa_number"
                                   class="form-input" 
                                   placeholder="07XXXXXXXX"
                                   maxlength="10">
                            <span class="form-hint">Enter your M-Pesa registered phone number</span>
                        </div>

                        <div class="mpesa-instructions">
                            <h4>How it works:</h4>
                            <ol>
                                <li>Enter your M-Pesa phone number</li>
                                <li>Click "Complete Purchase"</li>
                                <li>Check your phone for STK push notification</li>
                                <li>Enter your M-Pesa PIN to confirm</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Terms -->
                    <div class="terms-checkbox">
                        <label class="checkbox-label">
                            <input type="checkbox" name="terms_agree" id="terms_agree" required>
                            <span class="checkmark"></span>
                            <span class="checkbox-text">
                                I agree to the 
                                <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms of Service</a> 
                                and 
                                <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>
                            </span>
                        </label>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="submit-button">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
                        </svg>
                        Complete Purchase • ${{ stream.ticket_price }}
                    </button>

                    <a href="{% url 'stream_detail' stream.stream_id %}" class="cancel-link">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                        </svg>
                        Back to stream
                    </a>

                    <!-- Security Badge -->
                    <div class="security-badge">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                        </svg>
                        <span>Secured by SSL encryption</span>
                    </div>
                </form>
            </div>
        </div>

        <!-- Trust Badges -->
        <div class="trust-section">
            <div class="trust-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/>
                </svg>
                <div class="trust-content">
                    <h4>Instant Access</h4>
                    <p>Get immediate access after payment</p>
                </div>
            </div>
            <div class="trust-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"/>
                </svg>
                <div class="trust-content">
                    <h4>Money Back</h4>
                    <p>30-day refund guarantee</p>
                </div>
            </div>
            <div class="trust-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/>
                </svg>
                <div class="trust-content">
                    <h4>24/7 Support</h4>
                    <p>We're here to help anytime</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<div class="modal fade" id="termsModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Terms of Service</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>Stream Access Terms</h6>
                <p>By purchasing access to this stream, you agree to:</p>
                <ul>
                    <li>Use access for personal, non-commercial purposes only</li>
                    <li>Not share your access credentials with others</li>
                    <li>Not record or redistribute stream content</li>
                    <li>Accept that refunds are available within 30 days if stream is cancelled</li>
                    <li>Acknowledge that stream schedule may change</li>
                </ul>
                
                <h6 class="mt-4">Payment Terms</h6>
                <ul>
                    <li>All payments are processed securely</li>
                    <li>You'll receive a confirmation email</li>
                    <li>Payment information is encrypted</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="privacyModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Privacy Policy</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>Data Collection</h6>
                <p>We collect necessary information to process your payment:</p>
                <ul>
                    <li>Payment information is processed by secure providers</li>
                    <li>Purchase history is stored for your account</li>
                    <li>Personal data is protected and never shared</li>
                </ul>
                
                <h6 class="mt-4">Data Usage</h6>
                <ul>
                    <li>Payment data is used for transaction processing only</li>
                    <li>We may send important stream updates</li>
                    <li>Your information helps us improve services</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Modern Payment Page Design */
    .purchase-page {
        background: #f9f9f9;
        min-height: 100vh;
        padding: 80px 20px 60px;
    }

    .purchase-container {
        max-width: 1200px;
        margin: 0 auto;
    }

    /* Header */
    .purchase-header {
        text-align: center;
        margin-bottom: 48px;
    }

    .header-title {
        font-size: 32px;
        font-weight: 500;
        color: #030303;
        margin: 0 0 8px 0;
    }

    .header-subtitle {
        font-size: 16px;
        color: #606060;
        margin: 0;
    }

    /* Layout */
    .purchase-layout {
        display: grid;
        grid-template-columns: 1fr 1.2fr;
        gap: 32px;
        align-items: start;
    }

    /* Order Summary */
    .order-summary {
        background: white;
        border-radius: 12px;
        padding: 24px;
        position: sticky;
        top: 80px;
    }

    .section-title {
        font-size: 18px;
        font-weight: 500;
        color: #030303;
        margin: 0 0 20px 0;
    }

    .stream-card {
        margin-bottom: 24px;
    }

    .stream-thumbnail {
        position: relative;
        width: 100%;
        aspect-ratio: 16/9;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 16px;
    }

    .stream-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .premium-badge {
        position: absolute;
        top: 12px;
        left: 12px;
        background: #ffd700;
        color: #000;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .premium-badge svg {
        width: 14px;
        height: 14px;
    }

    .stream-info {
        margin-bottom: 20px;
    }

    .stream-title {
        font-size: 16px;
        font-weight: 500;
        color: #030303;
        margin: 0 0 6px 0;
        line-height: 1.4;
    }

    .stream-creator {
        font-size: 14px;
        color: #606060;
        display: flex;
        align-items: center;
        gap: 4px;
        margin: 0;
    }

    .verified-icon {
        width: 14px;
        height: 14px;
    }

    .stream-details {
        padding: 20px 0;
        border-top: 1px solid #e5e5e5;
        border-bottom: 1px solid #e5e5e5;
        margin-bottom: 20px;
    }

    .detail-row {
        display: flex;
        gap: 12px;
        padding: 10px 0;
    }

    .detail-row svg {
        width: 20px;
        height: 20px;
        color: #606060;
        flex-shrink: 0;
        margin-top: 2px;
    }

    .detail-content {
        flex: 1;
    }

    .detail-label {
        display: block;
        font-size: 12px;
        color: #606060;
        margin-bottom: 2px;
    }

    .detail-value {
        display: block;
        font-size: 14px;
        color: #030303;
    }

    .features-section {
        margin-bottom: 24px;
    }

    .features-title {
        font-size: 14px;
        font-weight: 500;
        color: #030303;
        margin: 0 0 12px 0;
    }

    .features-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .features-list li {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 0;
        font-size: 14px;
        color: #030303;
    }

    .features-list svg {
        width: 18px;
        height: 18px;
        color: #065fd4;
        flex-shrink: 0;
    }

    .price-breakdown {
        padding-top: 20px;
        border-top: 1px solid #e5e5e5;
    }

    .price-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        font-size: 14px;
        color: #606060;
    }

    .price-row.total {
        padding-top: 12px;
        margin-top: 8px;
        border-top: 1px solid #e5e5e5;
        font-size: 18px;
        font-weight: 500;
        color: #030303;
    }

    .total-amount {
        font-size: 24px;
        font-weight: 600;
        color: #065fd4;
    }

    /* Payment Section */
    .payment-section {
        background: white;
        border-radius: 12px;
        padding: 32px;
    }

    .payment-methods {
        margin-bottom: 24px;
    }

    .payment-method {
        display: block;
        margin-bottom: 12px;
        cursor: pointer;
    }

    .payment-method input[type="radio"] {
        display: none;
    }

    .method-content {
        padding: 16px;
        border: 2px solid #e5e5e5;
        border-radius: 8px;
        transition: all 0.2s;
    }

    .payment-method input:checked + .method-content {
        border-color: #065fd4;
        background: #f8f9ff;
    }

    .method-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 4px;
    }

    .method-header svg {
        width: 24px;
        height: 24px;
        color: #606060;
    }

    .method-name {
        font-size: 15px;
        font-weight: 500;
        color: #030303;
    }

    .method-description {
        font-size: 13px;
        color: #606060;
        margin-left: 36px;
    }

    .method-logos {
        display: flex;
        gap: 8px;
        margin-left: 36px;
        margin-top: 8px;
    }

    .card-logo {
        font-size: 10px;
        font-weight: 700;
        padding: 4px 8px;
        border-radius: 4px;
        background: #f2f2f2;
        color: #606060;
    }

    /* Form Fields */
    .payment-fields {
        margin-bottom: 24px;
    }

    .form-group {
        margin-bottom: 16px;
    }

    .form-label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        color: #030303;
        margin-bottom: 8px;
    }

    .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e5e5e5;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.2s;
        outline: none;
    }

    .form-input:focus {
        border-color: #065fd4;
    }

    .form-hint {
        display: block;
        font-size: 12px;
        color: #606060;
        margin-top: 6px;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }

    /* PayPal Redirect */
    .paypal-redirect {
        text-align: center;
        padding: 40px 20px;
        background: #f8f9ff;
        border-radius: 8px;
    }

    .paypal-redirect svg {
        width: 64px;
        height: 64px;
        color: #0070ba;
        margin-bottom: 16px;
    }

    .paypal-redirect p {
        font-size: 14px;
        color: #606060;
        margin: 0;
    }

    /* M-Pesa Instructions */
    .mpesa-instructions {
        background: #f8f9ff;
        padding: 20px;
        border-radius: 8px;
        margin-top: 16px;
    }

    .mpesa-instructions h4 {
        font-size: 14px;
        font-weight: 500;
        color: #030303;
        margin: 0 0 12px 0;
    }

    .mpesa-instructions ol {
        margin: 0;
        padding-left: 20px;
        font-size: 14px;
        color: #606060;
    }

    .mpesa-instructions li {
        margin-bottom: 6px;
        line-height: 1.5;
    }

    /* Terms Checkbox */
    .terms-checkbox {
        margin-bottom: 24px;
    }

    .checkbox-label {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        cursor: pointer;
        position: relative;
    }

    .checkbox-label input[type="checkbox"] {
        position: absolute;
        opacity: 0;
    }

    .checkmark {
        width: 20px;
        height: 20px;
        border: 2px solid #e5e5e5;
        border-radius: 4px;
        flex-shrink: 0;
        transition: all 0.2s;
    }

    .checkbox-label input:checked ~ .checkmark {
        background: #065fd4;
        border-color: #065fd4;
    }

    .checkbox-label input:checked ~ .checkmark::after {
        content: '';
        position: absolute;
        left: 6px;
        top: 2px;
        width: 5px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }

    .checkbox-text {
        font-size: 14px;
        color: #606060;
        line-height: 1.5;
    }

    .checkbox-text a {
        color: #065fd4;
        text-decoration: none;
    }

    .checkbox-text a:hover {
        text-decoration: underline;
    }

    /* Submit Button */
    .submit-button {
        width: 100%;
        padding: 16px;
        background: #065fd4;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-bottom: 16px;
    }

    .submit-button:hover {
        background: #0b7be8;
    }

    .submit-button:disabled {
        background: #ccc;
        cursor: not-allowed;
    }

    .submit-button svg {
        width: 20px;
        height: 20px;
    }

    .cancel-link {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px;
        color: #606060;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: color 0.2s;
    }

    .cancel-link:hover {
        color: #030303;
    }

    .cancel-link svg {
        width: 18px;
        height: 18px;
    }

    /* Security Badge */
    .security-badge {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding-top: 20px;
        margin-top: 20px;
        border-top: 1px solid #e5e5e5;
        color: #606060;
        font-size: 13px;
    }

    .security-badge svg {
        width: 18px;
        height: 18px;
        color: #28a745;
    }

    /* Trust Section */
    .trust-section {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
        margin-top: 48px;
    }

    .trust-item {
        background: white;
        padding: 24px;
        border-radius: 12px;
        text-align: center;
    }

    .trust-item svg {
        width: 48px;
        height: 48px;
        color: #065fd4;
        margin-bottom: 16px;
    }

    .trust-content h4 {
        font-size: 16px;
        font-weight: 500;
        color: #030303;
        margin: 0 0 6px 0;
    }

    .trust-content p {
        font-size: 14px;
        color: #606060;
        margin: 0;
    }

    /* Loading State */
    .loading .submit-button {
        position: relative;
    }

    .loading .submit-button svg {
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .purchase-layout {
            grid-template-columns: 1fr;
        }

        .order-summary {
            position: relative;
            top: 0;
        }
    }

    @media (max-width: 768px) {
        .purchase-page {
            padding: 70px 16px 40px;
        }

        .header-title {
            font-size: 24px;
        }

        .payment-section {
            padding: 24px;
        }

        .trust-section {
            grid-template-columns: 1fr;
        }

        .form-row {
            grid-template-columns: 1fr;
        gap: 0;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Payment method selection
    document.querySelectorAll('input[name="payment_method"]').forEach(radio => {
        radio.addEventListener('change', function() {
            // Hide all payment details
            document.querySelectorAll('.payment-details').forEach(detail => {
                detail.classList.add('d-none');
            });
            
            // Show selected payment details
            const selectedMethod = this.value;
            document.querySelector(`.${selectedMethod}-details`).classList.remove('d-none');
            
            // Update form validation based on selected method
            updateFormValidation(selectedMethod);
        });
    });

    function updateFormValidation(method) {
        // Reset all required attributes
        document.querySelectorAll('.payment-details input').forEach(input => {
            input.removeAttribute('required');
        });
        
        // Set required attributes for selected method
        if (method === 'mpesa') {
            document.getElementById('mpesa_number').setAttribute('required', 'required');
        } else if (method === 'card') {
            document.getElementById('card_number').setAttribute('required', 'required');
            document.getElementById('expiry_date').setAttribute('required', 'required');
            document.getElementById('cvv').setAttribute('required', 'required');
            document.getElementById('card_holder').setAttribute('required', 'required');
        }
        // PayPal doesn't require additional fields
    }

    // Form submission handling
    document.querySelector('.purchase-form').addEventListener('submit', function(e) {
        const termsAgreed = document.getElementById('terms_agree').checked;
        if (!termsAgreed) {
            e.preventDefault();
            alert('Please agree to the Terms of Service and Privacy Policy to continue.');
            return;
        }
        
        const selectedMethod = document.querySelector('input[name="payment_method"]:checked').value;
        
        // Show loading state
        const submitBtn = document.querySelector('.btn-purchase');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="bi bi-arrow-repeat spin me-2"></i>Processing...';
        submitBtn.disabled = true;
        
        // For demo purposes, we'll simulate processing
        if (selectedMethod === 'mpesa') {
            const mpesaNumber = document.getElementById('mpesa_number').value;
            if (!mpesaNumber) {
                e.preventDefault();
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                alert('Please enter your M-Pesa phone number.');
                return;
            }
        }
        
        // Form will submit normally for actual implementation
    });

    // Input formatting
    document.getElementById('mpesa_number')?.addEventListener('input', function(e) {
        this.value = this.value.replace(/\D/g, '').slice(0, 10);
    });

    document.getElementById('card_number')?.addEventListener('input', function(e) {
        this.value = this.value.replace(/\D/g, '').replace(/(.{4})/g, '$1 ').trim().slice(0, 19);
    });

    document.getElementById('expiry_date')?.addEventListener('input', function(e) {
        this.value = this.value.replace(/\D/g, '').replace(/(\d{2})(\d)/, '$1/$2').slice(0, 5);
    });

    document.getElementById('cvv')?.addEventListener('input', function(e) {
        this.value = this.value.replace(/\D/g, '').slice(0, 4);
    });

    // Add spin animation for loading
    const style = document.createElement('style');
    style.textContent = `
        .spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    `;
    document.head.appendChild(style);

    // Initialize form validation
    updateFormValidation('mpesa'); // Default to M-Pesa
</script>
{% endblock %}